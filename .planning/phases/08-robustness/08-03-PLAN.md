---
phase: 08-robustness
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/scholardoc_ocr/pipeline.py
  - src/scholardoc_ocr/processor.py
  - src/scholardoc_ocr/surya.py
autonomous: true

must_haves:
  truths:
    - "All except blocks capture full tracebacks, never silently lose error context"
    - "Worker error at pipeline.py line ~296 includes traceback, not just str(e)"
    - "Surya fallback warning at pipeline.py line ~408 includes exception type and traceback"
  artifacts:
    - path: "src/scholardoc_ocr/pipeline.py"
      provides: "Full traceback capture in all error paths"
      contains: "traceback"
  key_links:
    - from: "src/scholardoc_ocr/pipeline.py"
      to: "traceback.format_exc"
      via: "stdlib import"
      pattern: "traceback"
---

<objective>
Audit and fix all error handling paths in pipeline.py, processor.py, and surya.py to ensure full tracebacks are captured — no more empty `str(exc)` swallowing error context.

Purpose: ROBU-03 — exceptions with empty messages (common in C-extension errors from ocrmypdf/PyMuPDF) currently produce useless error strings. Every error path must capture the full traceback.
Output: Updated error handling in all three modules.
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-robustness/08-RESEARCH.md
@src/scholardoc_ocr/pipeline.py
@src/scholardoc_ocr/processor.py
@src/scholardoc_ocr/surya.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix all error handling paths to capture full tracebacks</name>
  <files>src/scholardoc_ocr/pipeline.py, src/scholardoc_ocr/processor.py, src/scholardoc_ocr/surya.py</files>
  <action>
Audit every `except` block in these three files. For each one:

**pipeline.py:**
1. Line ~192 (_tesseract_worker catch-all): Already uses `f"{type(e).__name__}: {e}"` — good but add `import traceback` and use `traceback.format_exc()` for the error field: `error=traceback.format_exc()`
2. Line ~296 (future.result() failure in Phase 1): Currently `error=str(e)` — change to `error=f"{type(e).__name__}: {e}\n{traceback.format_exc()}"` and use `logger.error("%s: worker failed: %s", path.name, e, exc_info=True)`
3. Line ~408 (Surya fallback failure): Currently `logger.warning("...: %s", e)` — change to `logger.warning("...: %s", e, exc_info=True)`

**processor.py:** Search for all `except` blocks. For any that use bare `str(e)` or `e` without traceback, add `exc_info=True` to the logger call or capture `traceback.format_exc()`.

**surya.py:** Same audit — ensure all except blocks include `exc_info=True` or capture traceback.

Import `traceback` at the top of any file that needs it. Use `exc_info=True` parameter in logger calls (preferred) rather than manually formatting tracebacks in log messages. Use `traceback.format_exc()` only for error fields stored in dataclasses/return values.
  </action>
  <verify>
    `ruff check src/scholardoc_ocr/pipeline.py src/scholardoc_ocr/processor.py src/scholardoc_ocr/surya.py`
    `grep -n "str(e)" src/scholardoc_ocr/pipeline.py src/scholardoc_ocr/processor.py src/scholardoc_ocr/surya.py` — should find zero bare str(e) in except blocks
  </verify>
  <done>All except blocks in pipeline.py, processor.py, and surya.py capture full tracebacks. No bare str(e) remains in error paths.</done>
</task>

</tasks>

<verification>
- `ruff check src/scholardoc_ocr/pipeline.py src/scholardoc_ocr/processor.py src/scholardoc_ocr/surya.py` passes
- `grep -rn "except.*:" src/scholardoc_ocr/pipeline.py | wc -l` vs `grep -rn "exc_info\|traceback" src/scholardoc_ocr/pipeline.py | wc -l` — every except has traceback handling
- `pytest` — existing tests still pass
</verification>

<success_criteria>
- No bare `str(e)` in except blocks across pipeline.py, processor.py, surya.py
- All logger.error/warning calls in except blocks use exc_info=True
- All error fields in returned dataclasses include traceback.format_exc()
</success_criteria>

<output>
After completion, create `.planning/phases/08-robustness/08-03-SUMMARY.md`
</output>
