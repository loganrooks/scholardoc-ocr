---
phase: 11-benchmarking-foundation-metrics-fixes
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/scholardoc_ocr/types.py
  - tests/test_types.py
autonomous: true

must_haves:
  truths:
    - "OCREngine.MIXED is a valid enum value"
    - "Serializing OCREngine.MIXED produces 'mixed' string"
  artifacts:
    - path: "src/scholardoc_ocr/types.py"
      provides: "MIXED enum value for mixed engine processing"
      contains: 'MIXED = "mixed"'
    - path: "tests/test_types.py"
      provides: "Test for MIXED enum value"
      contains: "OCREngine.MIXED"
  key_links:
    - from: "src/scholardoc_ocr/types.py"
      to: "JSON serialization"
      via: "StrEnum produces string value"
      pattern: 'MIXED = "mixed"'
---

<objective>
Add OCREngine.MIXED enum value to support BENCH-07 (engine field reflects mixed processing).

Purpose: BENCH-07 requires the top-level engine field to be "mixed" when some pages used Surya and others used Tesseract. This requires adding a new enum value.

Output: Updated types.py with MIXED enum, updated test file.
</objective>

<execution_context>
@/Users/rookslog/.claude/get-shit-done/workflows/execute-plan.md
@/Users/rookslog/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/11-benchmarking-foundation-metrics-fixes/11-RESEARCH.md

@src/scholardoc_ocr/types.py
@tests/test_types.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add OCREngine.MIXED enum value</name>
  <files>src/scholardoc_ocr/types.py</files>
  <action>
Update the OCREngine enum in src/scholardoc_ocr/types.py:

Add MIXED = "mixed" after the existing values. The enum should now be:

```python
class OCREngine(StrEnum):
    """OCR engine used for processing."""

    TESSERACT = "tesseract"
    SURYA = "surya"
    EXISTING = "existing"
    MIXED = "mixed"  # NEW: When some pages used Tesseract, others used Surya
    NONE = "none"
```

Also add a helper function to compute engine from page results:

```python
def compute_engine_from_pages(pages: list[PageResult]) -> OCREngine:
    """Determine top-level engine from per-page engines.

    Args:
        pages: List of PageResult objects with per-page engine values.

    Returns:
        - TESSERACT if all pages used Tesseract
        - SURYA if all pages used Surya
        - EXISTING if all pages had existing text
        - MIXED if multiple engines were used
        - NONE if no pages or all pages have NONE engine
    """
    engines = {p.engine for p in pages if p.engine != OCREngine.NONE}

    if not engines:
        return OCREngine.NONE
    if engines == {OCREngine.TESSERACT}:
        return OCREngine.TESSERACT
    if engines == {OCREngine.SURYA}:
        return OCREngine.SURYA
    if engines == {OCREngine.EXISTING}:
        return OCREngine.EXISTING
    # Multiple engines used = mixed
    return OCREngine.MIXED
```

Place the function after the PageResult class definition (since it takes list[PageResult]).
  </action>
  <verify>
    python -c "from scholardoc_ocr.types import OCREngine; print(OCREngine.MIXED)"
    python -c "from scholardoc_ocr.types import OCREngine; print(str(OCREngine.MIXED))"
  </verify>
  <done>
    OCREngine.MIXED exists and serializes to "mixed" string
  </done>
</task>

<task type="auto">
  <name>Task 2: Add tests for MIXED enum and compute_engine_from_pages</name>
  <files>tests/test_types.py</files>
  <action>
Read tests/test_types.py and add tests:

1. Test OCREngine.MIXED exists and serializes correctly:
```python
def test_ocr_engine_mixed():
    """Test MIXED enum value for mixed Tesseract+Surya processing."""
    assert OCREngine.MIXED == "mixed"
    assert str(OCREngine.MIXED) == "mixed"
```

2. Test compute_engine_from_pages function:
```python
from scholardoc_ocr.types import compute_engine_from_pages

def test_compute_engine_all_tesseract():
    """All Tesseract pages -> TESSERACT engine."""
    pages = [
        PageResult(page_number=0, status=PageStatus.GOOD, quality_score=0.9, engine=OCREngine.TESSERACT),
        PageResult(page_number=1, status=PageStatus.GOOD, quality_score=0.9, engine=OCREngine.TESSERACT),
    ]
    assert compute_engine_from_pages(pages) == OCREngine.TESSERACT

def test_compute_engine_mixed():
    """Tesseract + Surya pages -> MIXED engine."""
    pages = [
        PageResult(page_number=0, status=PageStatus.GOOD, quality_score=0.9, engine=OCREngine.TESSERACT),
        PageResult(page_number=1, status=PageStatus.GOOD, quality_score=0.95, engine=OCREngine.SURYA),
    ]
    assert compute_engine_from_pages(pages) == OCREngine.MIXED

def test_compute_engine_empty():
    """Empty pages list -> NONE engine."""
    assert compute_engine_from_pages([]) == OCREngine.NONE
```
  </action>
  <verify>
    pytest tests/test_types.py -v -k "mixed or compute_engine"
  </verify>
  <done>
    Tests verify MIXED enum and compute_engine_from_pages logic
  </done>
</task>

</tasks>

<verification>
- python -c "from scholardoc_ocr.types import OCREngine; assert OCREngine.MIXED == 'mixed'"
- python -c "from scholardoc_ocr.types import compute_engine_from_pages"
- pytest tests/test_types.py -v passes all tests including new MIXED tests
</verification>

<success_criteria>
- OCREngine.MIXED enum value exists
- compute_engine_from_pages() function exists and returns correct engine
- Tests pass for MIXED enum and compute function
</success_criteria>

<output>
After completion, create `.planning/phases/11-benchmarking-foundation-metrics-fixes/11-03-SUMMARY.md`
</output>
