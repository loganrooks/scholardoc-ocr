---
phase: 03-ocr-backend-modules
plan: 03
type: execute
wave: 2
depends_on: ["03-01", "03-02"]
files_modified:
  - src/scholardoc_ocr/processor.py
  - src/scholardoc_ocr/__init__.py
autonomous: true

must_haves:
  truths:
    - "PDFProcessor no longer contains run_tesseract, run_surya, or run_surya_batch methods"
    - "PDFProcessor retains all PDF manipulation methods (extract_text, extract_pages, replace_pages, etc.)"
    - "tesseract and surya modules are importable from scholardoc_ocr package"
    - "Existing tests still pass after processor cleanup"
  artifacts:
    - path: "src/scholardoc_ocr/processor.py"
      provides: "PDF manipulation only (no OCR methods)"
    - path: "src/scholardoc_ocr/__init__.py"
      provides: "Package exports including backend modules"
  key_links:
    - from: "src/scholardoc_ocr/__init__.py"
      to: "tesseract.py and surya.py"
      via: "package exports"
      pattern: "tesseract|surya"
---

<objective>
Remove OCR methods from PDFProcessor (now in tesseract.py and surya.py) and update package exports.

Purpose: Complete the extraction by cleaning up processor.py to be PDF-manipulation-only and exposing new backend modules in the package.
Output: Clean processor.py + updated __init__.py
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-ocr-backend-modules/03-01-SUMMARY.md
@.planning/phases/03-ocr-backend-modules/03-02-SUMMARY.md
@src/scholardoc_ocr/processor.py
@src/scholardoc_ocr/__init__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove OCR methods from PDFProcessor</name>
  <files>src/scholardoc_ocr/processor.py</files>
  <action>
Remove these methods from `PDFProcessor`:
- `run_tesseract()` — now in tesseract.py as `run_ocr()`
- `run_surya()` — now in surya.py as `convert_pdf()`
- `run_surya_batch()` — batch logic will be in pipeline (Phase 4), raw conversion in surya.py
- `combine_pages_from_multiple_pdfs()` — this is batch-orchestration logic, will move to Phase 4

Keep these methods (PDF manipulation):
- `__init__`, `fitz` property, `_open_pdf`
- `extract_text`, `extract_text_by_page`
- `extract_pages`, `replace_pages`
- `get_page_count`

Remove unused imports that were only needed by OCR methods (subprocess, sys, ModelEvent, ProgressEvent from callbacks). Keep imports needed by remaining methods.

Update the module docstring to reflect "PDF manipulation with PyMuPDF" (remove "and ocrmypdf" reference).

Keep `ProcessingResult` and `ProcessorConfig` dataclasses — these are used by pipeline.py and will be refactored in Phase 4.
  </action>
  <verify>
Run `python -c "from scholardoc_ocr.processor import PDFProcessor; p = PDFProcessor(); print(dir(p))"` — should NOT include run_tesseract, run_surya, run_surya_batch, combine_pages_from_multiple_pdfs.

Run `pytest tests/test_processor.py -v` — existing processor tests still pass.
  </verify>
  <done>PDFProcessor has only PDF manipulation methods. No OCR logic remains. Existing tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Update package exports</name>
  <files>src/scholardoc_ocr/__init__.py</files>
  <action>
Update `src/scholardoc_ocr/__init__.py` to expose new backend modules:

1. Read current __init__.py to understand existing exports
2. Add lazy-friendly references to tesseract and surya modules. Do NOT eagerly import from them (that would trigger heavy imports). Instead:
   - Add them to `__all__` if `__all__` exists
   - Or add a comment noting they are available as `scholardoc_ocr.tesseract` and `scholardoc_ocr.surya`
3. The key public API additions are:
   - `scholardoc_ocr.tesseract.run_ocr`
   - `scholardoc_ocr.tesseract.TesseractConfig`
   - `scholardoc_ocr.surya.load_models`
   - `scholardoc_ocr.surya.convert_pdf`
   - `scholardoc_ocr.surya.SuryaConfig`

Do NOT add `from .tesseract import *` or `from .surya import *` at package level — this would defeat lazy loading. Submodule access (`from scholardoc_ocr.tesseract import run_ocr`) is the intended pattern.
  </action>
  <verify>
Run `python -c "from scholardoc_ocr.tesseract import run_ocr; from scholardoc_ocr.surya import load_models; print('OK')"` — works.

Run `pytest` — all existing tests pass (no regressions from cleanup).

Run `ruff check src/scholardoc_ocr/` — lint clean.
  </verify>
  <done>Package exports updated. Backend modules accessible via submodule imports. All existing tests pass. Lint clean.</done>
</task>

</tasks>

<verification>
1. `pytest` — full test suite passes (no regressions)
2. `ruff check src/scholardoc_ocr/` — lint clean
3. PDFProcessor has no OCR methods (only PDF manipulation)
4. `from scholardoc_ocr.tesseract import run_ocr` works
5. `from scholardoc_ocr.surya import load_models` works
6. No heavy imports triggered by package-level import
</verification>

<success_criteria>
- processor.py is PDF-manipulation-only
- OCR backends accessible as submodules
- Full test suite passes
- No import regressions
</success_criteria>

<output>
After completion, create `.planning/phases/03-ocr-backend-modules/03-03-SUMMARY.md`
</output>
