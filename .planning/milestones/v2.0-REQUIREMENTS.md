# Requirements Archive: v2.0 Post-Processing + Robustness

**Archived:** 2026-02-03
**Status:** ✅ SHIPPED

This is the archived requirements specification for v2.0.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

## v2.0 Requirements

### Post-Processing

- [x] **POST-01**: Unicode NFC normalization applied to all extracted text (Tesseract and Surya output unified)
- [x] **POST-02**: Soft hyphens (U+00AD) stripped from output
- [x] **POST-03**: Ligatures decomposed to ASCII equivalents (fi, fl, ff, ffi, ffl)
- [x] **POST-04**: Line breaks within paragraphs normalized to spaces; paragraph boundaries preserved
- [x] **POST-05**: Hyphenated words split across lines rejoined (basic pattern: word-\nword)
- [x] **POST-06**: Language-aware dehyphenation — German compounds and French hyphenated names preserved as intentional hyphens
- [x] **POST-07**: Punctuation normalized (whitespace around punctuation, double spaces collapsed)

### Robustness

- [x] **ROBU-01**: Structured multiprocess logging via QueueHandler/QueueListener — worker logs reach main process on macOS
- [x] **ROBU-02**: Environment validation on startup — tesseract binary, required language packs, TMPDIR writable
- [x] **ROBU-03**: Full tracebacks captured in all error paths (no more empty str(exc))
- [x] **ROBU-04**: Work directory cleaned up on successful completion
- [x] **ROBU-05**: `--keep-intermediates` flag to preserve work directory for debugging
- [x] **ROBU-06**: Worker timeout protection — individual file processing has configurable timeout
- [x] **ROBU-07**: Per-worker log files with process ID prefix for debugging parallel runs
- [x] **ROBU-08**: Startup diagnostic report (log tesseract version, available langs, TMPDIR, Python version)

### Output

- [x] **OUTP-01**: JSON metadata file written alongside output PDF (quality scores per page, surya fallback pages, processing stats)
- [x] **OUTP-02**: `--extract-text` CLI flag triggers post-processing pipeline and writes .txt alongside output
- [x] **OUTP-03**: MCP async job handling — long OCR runs return job ID immediately, `ocr_status(job_id)` endpoint for checking progress
- [x] **OUTP-04**: MCP progress events emitted during processing (pages completed, current file)
- [x] **OUTP-05**: `--json` CLI flag outputs structured JSON results to stdout

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| POST-01 | Phase 9 | Complete |
| POST-02 | Phase 9 | Complete |
| POST-03 | Phase 9 | Complete |
| POST-04 | Phase 9 | Complete |
| POST-05 | Phase 9 | Complete |
| POST-06 | Phase 9 | Complete |
| POST-07 | Phase 9 | Complete |
| ROBU-01 | Phase 8 | Complete |
| ROBU-02 | Phase 8 | Complete |
| ROBU-03 | Phase 8 | Complete |
| ROBU-04 | Phase 8 | Complete |
| ROBU-05 | Phase 8 | Complete |
| ROBU-06 | Phase 8 | Complete |
| ROBU-07 | Phase 8 | Complete |
| ROBU-08 | Phase 8 | Complete |
| OUTP-01 | Phase 10 | Complete |
| OUTP-02 | Phase 10 | Complete |
| OUTP-03 | Phase 10 | Complete |
| OUTP-04 | Phase 10 | Complete |
| OUTP-05 | Phase 10 | Complete |

---

## Milestone Summary

**Shipped:** 20 of 20 v2.0 requirements
**Adjusted:** None — all requirements implemented as specified
**Dropped:** None

---
*Archived: 2026-02-03 as part of v2.0 milestone completion*
